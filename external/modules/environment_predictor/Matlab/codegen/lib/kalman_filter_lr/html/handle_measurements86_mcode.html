<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="43,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T2U3">H</span>, <span class="var type1" id="S3T1U4">z</span>, <span class="var type1" id="S4T1U5">zm</span>] = handle_measurements(<span class="var type1" id="S5T1U8">r</span>, <span class="var type1" id="S6T3U9">delta</span>, <span class="var type2" id="S7T3V1U10">proj_dist</span>, <span class="var type1" id="S8T1U11">xm</span>, <span class="var type1" id="S9T1U12">ym</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="43,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,3" id="srcline3"> 3</a></span><span class="line"><span class="keyword">if</span> <span class="var type1" id="S7T3U16">proj_dist</span> ~= 0</span></span>
<span class="srcline"><span class="lineno"><a href="43,4" id="srcline4"> 4</a></span><span class="line">    [<span class="var type1" id="S10T1U21">xp</span>, <span class="var type1" id="S11T1U22">yp</span>, <span class="var type1" id="S12T1U23">phi</span>] = <span class="fcn" id="F59N7:B25">projectPoints</span>(<span class="var type1" id="S5T1U26">r</span>, <span class="var type1" id="S6T3U27">delta</span>, <span class="var type1" id="S7T3U28">proj_dist</span>); <span class="comment">%Punkte von Mittellinie nach links/rechts projizieren</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,5" id="srcline5"> 5</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,6" id="srcline6"> 6</a></span><span class="line">    [<span class="var type0" id="S10T0U33">xp</span>, <span class="var type0" id="S11T0U34">yp</span>, <span class="var type0" id="S12T0U35">phi</span>] = getPointsFromState(<span class="var type0" id="S5T0U38">r</span>, <span class="var type0" id="S6T0U39">delta</span>); </span></span>
<span class="srcline"><span class="lineno"><a href="43,7" id="srcline7"> 7</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,8" id="srcline8"> 8</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,9" id="srcline9"> 9</a></span><span class="line"><span class="mxinfo " id="T17:U16"><span class="var type1" id="S15T17U42">P</span> = <span class="mxinfo " id="T17:U18">[<span class="var type1" id="S10T1U45">xp</span>, <span class="var type1" id="S11T1U46">yp</span>, <span class="var type1" id="S12T1U47">phi</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,10" id="srcline10">10</a></span><span class="line"><span class="mxinfo " id="T17:U22"><span class="var type1" id="S16T17U50">D</span> = <span class="mxinfo " id="T17:U24"><span class="mxinfo " id="T3:U25">10000</span>*<span class="mxinfo " id="T17:U26">ones(<span class="mxinfo " id="T3:U27">numel(<span class="var type1" id="S8T1U57">xm</span>)</span>, <span class="mxinfo " id="T19:U29">3</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,11" id="srcline11">11</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,12" id="srcline12">12</a></span><span class="line"><span class="comment">% Fuer jeden Messpunkt den nähesten Punkt der aktuellen Praediktion finden </span></span></span>
<span class="srcline"><span class="lineno"><a href="43,13" id="srcline13">13</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S19T3U61">s</span>=<span class="mxinfo " id="T3:U31">1</span>:<span class="mxinfo " id="T3:U32">numel(<span class="var type1" id="S5T1U66">r</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,14" id="srcline14">14</a></span><span class="line">   <span class="keyword">for</span> <span class="var type1" id="S20T3U69">m</span>=<span class="mxinfo " id="T3:U35">1</span>:<span class="mxinfo " id="T3:U36">numel(<span class="var type1" id="S8T1U74">xm</span>)</span>            </span></span>
<span class="srcline"><span class="lineno"><a href="43,15" id="srcline15">15</a></span><span class="line">        <span class="mxinfo " id="T3:U38"><span class="var type1" id="S21T3U77">dist_point</span> = <span class="mxinfo " id="T3:U40">sqrt(<span class="mxinfo " id="T3:U41"><span class="mxinfo " id="T3:U42">(<span class="mxinfo " id="T3:U43"><span class="mxinfo " id="T3:U44"><span class="var type1" id="S15T17U85">P</span>(<span class="var type1" id="S19T3U86">s</span>, <span class="mxinfo " id="T19:U47">1</span>)</span>-(<span class="mxinfo " id="T3:U48"><span class="var type1" id="S8T1U90">xm</span>(<span class="var type1" id="S20T3U91">m</span>)</span>)</span>)^2</span> + <span class="mxinfo " id="T3:U51">(<span class="mxinfo " id="T3:U52"><span class="mxinfo " id="T3:U53"><span class="var type1" id="S15T17U97">P</span>(<span class="var type1" id="S19T3U98">s</span>, <span class="mxinfo " id="T19:U56">2</span>)</span>-(<span class="mxinfo " id="T3:U57"><span class="var type1" id="S9T1U102">ym</span>(<span class="var type1" id="S20T3U103">m</span>)</span>)</span>)^2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,16" id="srcline16">16</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T5:U60"><span class="var type1" id="S21T3U108">dist_point</span> &lt; <span class="mxinfo " id="T3:U62"><span class="var type1" id="S16T17U110">D</span>(<span class="var type1" id="S20T3U111">m</span>, <span class="mxinfo " id="T3:U65">3</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="43,17" id="srcline17">17</a></span><span class="line">            <span class="mxinfo " id="T3:U66"><span class="mxinfo " id="T3:U67"><span class="var type1" id="S16T17U116">D</span>(<span class="var type1" id="S20T3U117">m</span>, <span class="mxinfo " id="T3:U70">1</span>)</span> = <span class="var type1" id="S19T3U119">s</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,18" id="srcline18">18</a></span><span class="line">            <span class="mxinfo " id="T3:U72"><span class="mxinfo " id="T3:U73"><span class="var type1" id="S16T17U123">D</span>(<span class="var type1" id="S20T3U124">m</span>, <span class="mxinfo " id="T3:U76">2</span>)</span> = <span class="mxinfo " id="T3:U77">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,19" id="srcline19">19</a></span><span class="line">            <span class="mxinfo " id="T3:U78"><span class="mxinfo " id="T3:U79"><span class="var type1" id="S16T17U130">D</span>(<span class="var type1" id="S20T3U131">m</span>, <span class="mxinfo " id="T3:U82">3</span>)</span> = <span class="var type1" id="S21T3U133">dist_point</span></span>;            </span></span>
<span class="srcline"><span class="lineno"><a href="43,20" id="srcline20">20</a></span><span class="line">        <span class="keyword">end</span>            </span></span>
<span class="srcline"><span class="lineno"><a href="43,21" id="srcline21">21</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T5:U84"><span class="var type1" id="S19T3U137">s</span> &gt; <span class="mxinfo " id="T3:U86">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="43,22" id="srcline22">22</a></span><span class="line">            [<span class="var type1" id="S23T3U142">dist_line</span>, <span class="var type1" id="S24T3U143">lambda</span>, <span class="mxinfo " id="T3:U89">~</span>] = <span class="fcn" id="F66N2:B146">d_line_point</span>(<span class="mxinfo " id="T31:U90">[<span class="mxinfo " id="T3:U91"><span class="var type1" id="S15T17U150">P</span>(<span class="mxinfo " id="T3:U93"><span class="var type1" id="S19T3U152">s</span>-<span class="mxinfo " id="T3:U95">1</span></span>, <span class="mxinfo " id="T19:U96">1</span>)</span>, <span class="mxinfo " id="T3:U97"><span class="var type1" id="S15T17U156">P</span>(<span class="mxinfo " id="T3:U99"><span class="var type1" id="S19T3U158">s</span>-<span class="mxinfo " id="T3:U101">1</span></span>, <span class="mxinfo " id="T19:U102">2</span>)</span>]</span>, <span class="mxinfo " id="T31:U103">[<span class="mxinfo " id="T3:U104"><span class="var type1" id="S15T17U164">P</span>(<span class="var type1" id="S19T3U165">s</span>, <span class="mxinfo " id="T19:U107">1</span>)</span>, <span class="mxinfo " id="T3:U108"><span class="var type1" id="S15T17U168">P</span>(<span class="var type1" id="S19T3U169">s</span>, <span class="mxinfo " id="T19:U111">2</span>)</span>]</span>, <span class="mxinfo " id="T31:U112">[<span class="mxinfo " id="T3:U113"><span class="var type1" id="S8T1U174">xm</span>(<span class="var type1" id="S20T3U175">m</span>)</span>, <span class="mxinfo " id="T3:U116"><span class="var type1" id="S9T1U177">ym</span>(<span class="var type1" id="S20T3U178">m</span>)</span>]</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,23" id="srcline23">23</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T5:U119"><span class="var type1" id="S23T3U184">dist_line</span> &lt; <span class="mxinfo " id="T3:U121"><span class="var type1" id="S16T17U186">D</span>(<span class="var type1" id="S20T3U187">m</span>, <span class="mxinfo " id="T3:U124">3</span>)</span></span> &amp;&amp; <span class="mxinfo " id="T5:U125"><span class="var type1" id="S24T3U190">lambda</span> &gt; <span class="mxinfo " id="T3:U127">0</span></span> &amp;&amp; <span class="mxinfo " id="T5:U128"><span class="var type1" id="S24T3U193">lambda</span> &lt; <span class="mxinfo " id="T3:U130">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="43,24" id="srcline24">24</a></span><span class="line">                <span class="mxinfo " id="T3:U131"><span class="mxinfo " id="T3:U132"><span class="var type1" id="S16T17U198">D</span>(<span class="var type1" id="S20T3U199">m</span>, <span class="mxinfo " id="T3:U135">1</span>)</span> = <span class="mxinfo " id="T3:U136"><span class="var type1" id="S19T3U202">s</span>-<span class="mxinfo " id="T3:U138">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,25" id="srcline25">25</a></span><span class="line">                <span class="mxinfo " id="T3:U139"><span class="mxinfo " id="T3:U140"><span class="var type1" id="S16T17U207">D</span>(<span class="var type1" id="S20T3U208">m</span>, <span class="mxinfo " id="T3:U143">2</span>)</span> = <span class="var type1" id="S24T3U210">lambda</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,26" id="srcline26">26</a></span><span class="line">                <span class="mxinfo " id="T3:U145"><span class="mxinfo " id="T3:U146"><span class="var type1" id="S16T17U214">D</span>(<span class="var type1" id="S20T3U215">m</span>, <span class="mxinfo " id="T3:U149">3</span>)</span> = <span class="var type1" id="S23T3U217">dist_line</span></span>;              </span></span>
<span class="srcline"><span class="lineno"><a href="43,27" id="srcline27">27</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,28" id="srcline28">28</a></span><span class="line">        <span class="keyword">end</span>         </span></span>
<span class="srcline"><span class="lineno"><a href="43,29" id="srcline29">29</a></span><span class="line">    <span class="keyword">end</span> </span></span>
<span class="srcline"><span class="lineno"><a href="43,30" id="srcline30">30</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,31" id="srcline31">31</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,32" id="srcline32">32</a></span><span class="line"><span class="comment">% Messpunkte ausfiltern, die vor dem letzten prädizierten Punkt oder zu weit entfernt liegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,33" id="srcline33">33</a></span><span class="line"><span class="mxinfo " id="T32:U151"><span class="var type1" id="S26T32U220">ind</span> = (<span class="mxinfo " id="T32:U153"><span class="mxinfo " id="T32:U154"><span class="mxinfo " id="T1:U155"><span class="var type1" id="S16T17U225">D</span>(<span class="mxinfo " id="T18:U157">:</span>, <span class="mxinfo " id="T19:U158">1</span>)</span> == <span class="mxinfo " id="T3:U159">numel(<span class="var type1" id="S5T1U230">r</span>)</span></span> | <span class="mxinfo " id="T32:U161"><span class="mxinfo " id="T1:U162"><span class="var type1" id="S16T17U233">D</span>(<span class="mxinfo " id="T18:U164">:</span>, <span class="mxinfo " id="T3:U165">3</span>)</span> &gt; <span class="mxinfo " id="T3:U166">0.5</span></span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,34" id="srcline34">34</a></span><span class="line"><span class="mxinfo " id="T1:U167"><span class="var type1" id="S8T1U240">xm</span>(<span class="var type1" id="S26T32U241">ind</span>) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,35" id="srcline35">35</a></span><span class="line"><span class="mxinfo " id="T1:U170"><span class="var type1" id="S9T1U247">ym</span>(<span class="var type1" id="S26T32U248">ind</span>) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,36" id="srcline36">36</a></span><span class="line"><span class="mxinfo " id="T17:U173"><span class="var type1" id="S16T17U254">D</span>(<span class="var type1" id="S26T32U255">ind</span>, :) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,37" id="srcline37">37</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,38" id="srcline38">38</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,39" id="srcline39">39</a></span><span class="line"><span class="comment">% Messmatrix H, Messvektor z und Erwartungsvektor zm berechnen</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,40" id="srcline40">40</a></span><span class="line"><span class="mxinfo " id="T2:U176"><span class="var type1" id="S2T2U261">H</span> = <span class="mxinfo " id="T2:U178"><span class="fcn" id="F85N6:B263">messmatrix</span>(<span class="var type1" id="S15T17U264">P</span>, <span class="var type1" id="S5T1U265">r</span>, <span class="var type1" id="S6T3U266">delta</span>, <span class="mxinfo " id="T1:U182"><span class="var type1" id="S16T17U268">D</span>(<span class="mxinfo " id="T18:U184">:</span>, <span class="mxinfo " id="T19:U185">1</span>)</span>, <span class="mxinfo " id="T1:U186"><span class="var type1" id="S16T17U272">D</span>(<span class="mxinfo " id="T18:U188">:</span>, <span class="mxinfo " id="T19:U189">2</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,41" id="srcline41">41</a></span><span class="line"><span class="mxinfo " id="T1:U190"><span class="var type1" id="S3T1U277">z</span> =  <span class="mxinfo " id="T1:U192">zeros(<span class="mxinfo " id="T3:U193"><span class="mxinfo " id="T3:U194">2</span>*<span class="mxinfo " id="T3:U195">numel(<span class="var type1" id="S8T1U284">xm</span>)</span></span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,42" id="srcline42">42</a></span><span class="line"><span class="mxinfo " id="T1:U197"><span class="var type1" id="S4T1U288">zm</span> = <span class="mxinfo " id="T1:U199">zeros(<span class="mxinfo " id="T3:U200"><span class="mxinfo " id="T3:U201">2</span>*<span class="mxinfo " id="T3:U202">numel(<span class="var type1" id="S8T1U295">xm</span>)</span></span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,43" id="srcline43">43</a></span><span class="line"><span class="mxinfo " id="T3:U204"><span class="var type1" id="S29T3U299">count</span> = <span class="mxinfo " id="T3:U206">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,44" id="srcline44">44</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S20T3U303">m</span>=<span class="mxinfo " id="T3:U208">1</span>:<span class="mxinfo " id="T3:U209">numel(<span class="var type1" id="S8T1U308">xm</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,45" id="srcline45">45</a></span><span class="line">        <span class="mxinfo " id="T3:U211"><span class="mxinfo " id="T3:U212"><span class="var type1" id="S3T1U312">z</span>(<span class="var type1" id="S29T3U313">count</span>)</span> = <span class="mxinfo " id="T3:U215"><span class="var type1" id="S8T1U315">xm</span>(<span class="var type1" id="S20T3U316">m</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,46" id="srcline46">46</a></span><span class="line">        <span class="mxinfo " id="T3:U218"><span class="mxinfo " id="T3:U219"><span class="var type1" id="S3T1U320">z</span>(<span class="mxinfo " id="T3:U221"><span class="var type1" id="S29T3U322">count</span> + <span class="mxinfo " id="T3:U223">1</span></span>)</span> = <span class="mxinfo " id="T3:U224"><span class="var type1" id="S9T1U325">ym</span>(<span class="var type1" id="S20T3U326">m</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,47" id="srcline47">47</a></span><span class="line">        <span class="mxinfo " id="T3:U227"><span class="mxinfo " id="T3:U228"><span class="var type1" id="S4T1U330">zm</span>(<span class="var type1" id="S29T3U331">count</span>)</span>     = <span class="mxinfo " id="T3:U231"><span class="mxinfo " id="T3:U232"><span class="var type1" id="S15T17U334">P</span>(<span class="mxinfo " id="T3:U234"><span class="var type1" id="S16T17U336">D</span>(<span class="var type1" id="S20T3U337">m</span>, <span class="mxinfo " id="T19:U237">1</span>)</span>, <span class="mxinfo " id="T3:U238">1</span>)</span> + <span class="mxinfo " id="T3:U239"><span class="mxinfo " id="T3:U240"><span class="var type1" id="S16T17U342">D</span>(<span class="var type1" id="S20T3U343">m</span>, <span class="mxinfo " id="T3:U243">2</span>)</span> * (<span class="mxinfo " id="T3:U244"><span class="mxinfo " id="T3:U245"><span class="var type1" id="S15T17U348">P</span>(<span class="mxinfo " id="T3:U247"><span class="mxinfo " id="T3:U248"><span class="var type1" id="S16T17U351">D</span>(<span class="var type1" id="S20T3U352">m</span>, <span class="mxinfo " id="T19:U251">1</span>)</span>+<span class="mxinfo " id="T3:U252">1</span></span>, <span class="mxinfo " id="T3:U253">1</span>)</span> - <span class="mxinfo " id="T3:U254"><span class="var type1" id="S15T17U357">P</span>(<span class="mxinfo " id="T3:U256"><span class="var type1" id="S16T17U359">D</span>(<span class="var type1" id="S20T3U360">m</span>, <span class="mxinfo " id="T19:U259">1</span>)</span>, <span class="mxinfo " id="T3:U260">1</span>)</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,48" id="srcline48">48</a></span><span class="line">        <span class="mxinfo " id="T3:U261"><span class="mxinfo " id="T3:U262"><span class="var type1" id="S4T1U366">zm</span>(<span class="mxinfo " id="T3:U264"><span class="var type1" id="S29T3U368">count</span> + <span class="mxinfo " id="T3:U266">1</span></span>)</span> = <span class="mxinfo " id="T3:U267"><span class="mxinfo " id="T3:U268"><span class="var type1" id="S15T17U372">P</span>(<span class="mxinfo " id="T3:U270"><span class="var type1" id="S16T17U374">D</span>(<span class="var type1" id="S20T3U375">m</span>, <span class="mxinfo " id="T19:U273">1</span>)</span>, <span class="mxinfo " id="T3:U274">2</span>)</span> + <span class="mxinfo " id="T3:U275"><span class="mxinfo " id="T3:U276"><span class="var type1" id="S16T17U380">D</span>(<span class="var type1" id="S20T3U381">m</span>, <span class="mxinfo " id="T3:U279">2</span>)</span> * (<span class="mxinfo " id="T3:U280"><span class="mxinfo " id="T3:U281"><span class="var type1" id="S15T17U386">P</span>(<span class="mxinfo " id="T3:U283"><span class="mxinfo " id="T3:U284"><span class="var type1" id="S16T17U389">D</span>(<span class="var type1" id="S20T3U390">m</span>, <span class="mxinfo " id="T19:U287">1</span>)</span>+<span class="mxinfo " id="T3:U288">1</span></span>, <span class="mxinfo " id="T3:U289">2</span>)</span> - <span class="mxinfo " id="T3:U290"><span class="var type1" id="S15T17U395">P</span>(<span class="mxinfo " id="T3:U292"><span class="var type1" id="S16T17U397">D</span>(<span class="var type1" id="S20T3U398">m</span>, <span class="mxinfo " id="T19:U295">1</span>)</span>, <span class="mxinfo " id="T3:U296">2</span>)</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,49" id="srcline49">49</a></span><span class="line">        <span class="mxinfo " id="T3:U297"><span class="var type1" id="S29T3U403">count</span> = <span class="mxinfo " id="T3:U299"><span class="var type1" id="S29T3U405">count</span> + <span class="mxinfo " id="T3:U301">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,50" id="srcline50">50</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
</pre>
