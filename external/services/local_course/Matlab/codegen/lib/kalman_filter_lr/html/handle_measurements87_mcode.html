<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="43,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T2U3">H</span>, <span class="var type1" id="S3T1U4">z</span>, <span class="var type1" id="S4T1U5">zm</span>, <span class="var type1" id="S5T3U6">nValidPoints</span>] = handle_measurements(<span class="var type1" id="S6T1U9">r</span>, <span class="var type1" id="S7T3U10">delta</span>, <span class="var type2" id="S8T3V2U11">proj_dist</span>, <span class="var type1" id="S9T1U12">xm</span>, <span class="var type1" id="S10T1U13">ym</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="43,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,3" id="srcline3"> 3</a></span><span class="line">[<span class="var type1" id="S11T1U17">xp</span>, <span class="var type1" id="S12T1U18">yp</span>, <span class="var type1" id="S13T1U19">phi</span>] = <span class="fcn" id="F59N7:B21">projectPoints</span>(<span class="var type1" id="S6T1U22">r</span>, <span class="var type1" id="S7T3U23">delta</span>, <span class="var type1" id="S8T3U24">proj_dist</span>); <span class="comment">%Punkte von Mittellinie nach links/rechts projizieren</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,4" id="srcline4"> 4</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,5" id="srcline5"> 5</a></span><span class="line"><span class="mxinfo " id="T17:U16"><span class="var type1" id="S15T17U27">P</span> = <span class="mxinfo " id="T17:U18">[<span class="var type1" id="S11T1U30">xp</span>, <span class="var type1" id="S12T1U31">yp</span>, <span class="var type1" id="S13T1U32">phi</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,6" id="srcline6"> 6</a></span><span class="line"><span class="mxinfo " id="T17:U22"><span class="var type1" id="S16T17U35">D</span> = <span class="mxinfo " id="T17:U24"><span class="mxinfo " id="T3:U25">10000</span>*<span class="mxinfo " id="T17:U26">ones(<span class="mxinfo " id="T3:U27">numel(<span class="var type1" id="S9T1U42">xm</span>)</span>, <span class="mxinfo " id="T19:U29">3</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,7" id="srcline7"> 7</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,8" id="srcline8"> 8</a></span><span class="line"><span class="comment">% Fuer jeden Messpunkt den nächsten Punkt der aktuellen Praediktion finden </span></span></span>
<span class="srcline"><span class="lineno"><a href="43,9" id="srcline9"> 9</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S19T3U46">s</span>=<span class="mxinfo " id="T3:U31">1</span>:<span class="mxinfo " id="T3:U32">numel(<span class="var type1" id="S6T1U51">r</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,10" id="srcline10">10</a></span><span class="line">   <span class="keyword">for</span> <span class="var type1" id="S20T3U54">m</span>=<span class="mxinfo " id="T3:U35">1</span>:<span class="mxinfo " id="T3:U36">numel(<span class="var type1" id="S9T1U59">xm</span>)</span>            </span></span>
<span class="srcline"><span class="lineno"><a href="43,11" id="srcline11">11</a></span><span class="line">        <span class="mxinfo " id="T3:U38"><span class="var type1" id="S21T3U62">dist_point</span> = <span class="mxinfo " id="T3:U40">sqrt(<span class="mxinfo " id="T3:U41"><span class="mxinfo " id="T3:U42">(<span class="mxinfo " id="T3:U43"><span class="mxinfo " id="T3:U44"><span class="var type1" id="S15T17U70">P</span>(<span class="var type1" id="S19T3U71">s</span>, <span class="mxinfo " id="T19:U47">1</span>)</span>-(<span class="mxinfo " id="T3:U48"><span class="var type1" id="S9T1U75">xm</span>(<span class="var type1" id="S20T3U76">m</span>)</span>)</span>)^2</span> + <span class="mxinfo " id="T3:U51">(<span class="mxinfo " id="T3:U52"><span class="mxinfo " id="T3:U53"><span class="var type1" id="S15T17U82">P</span>(<span class="var type1" id="S19T3U83">s</span>, <span class="mxinfo " id="T19:U56">2</span>)</span>-(<span class="mxinfo " id="T3:U57"><span class="var type1" id="S10T1U87">ym</span>(<span class="var type1" id="S20T3U88">m</span>)</span>)</span>)^2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,12" id="srcline12">12</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T5:U60"><span class="var type1" id="S21T3U93">dist_point</span> &lt; <span class="mxinfo " id="T3:U62"><span class="var type1" id="S16T17U95">D</span>(<span class="var type1" id="S20T3U96">m</span>, <span class="mxinfo " id="T3:U65">3</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="43,13" id="srcline13">13</a></span><span class="line">            <span class="mxinfo " id="T3:U66"><span class="mxinfo " id="T3:U67"><span class="var type1" id="S16T17U101">D</span>(<span class="var type1" id="S20T3U102">m</span>, <span class="mxinfo " id="T3:U70">1</span>)</span> = <span class="var type1" id="S19T3U104">s</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,14" id="srcline14">14</a></span><span class="line">            <span class="mxinfo " id="T3:U72"><span class="mxinfo " id="T3:U73"><span class="var type1" id="S16T17U108">D</span>(<span class="var type1" id="S20T3U109">m</span>, <span class="mxinfo " id="T3:U76">2</span>)</span> = <span class="mxinfo " id="T3:U77">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,15" id="srcline15">15</a></span><span class="line">            <span class="mxinfo " id="T3:U78"><span class="mxinfo " id="T3:U79"><span class="var type1" id="S16T17U115">D</span>(<span class="var type1" id="S20T3U116">m</span>, <span class="mxinfo " id="T3:U82">3</span>)</span> = <span class="var type1" id="S21T3U118">dist_point</span></span>;            </span></span>
<span class="srcline"><span class="lineno"><a href="43,16" id="srcline16">16</a></span><span class="line">        <span class="keyword">end</span>            </span></span>
<span class="srcline"><span class="lineno"><a href="43,17" id="srcline17">17</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T5:U84"><span class="var type1" id="S19T3U122">s</span> &gt; <span class="mxinfo " id="T3:U86">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="43,18" id="srcline18">18</a></span><span class="line">            [<span class="var type1" id="S23T3U127">dist_line</span>, <span class="var type1" id="S24T3U128">lambda</span>, <span class="mxinfo " id="T3:U89">~</span>] = <span class="fcn" id="F66N2:B131">d_line_point</span>(<span class="mxinfo " id="T30:U90">[<span class="mxinfo " id="T3:U91"><span class="var type1" id="S15T17U135">P</span>(<span class="mxinfo " id="T3:U93"><span class="var type1" id="S19T3U137">s</span>-<span class="mxinfo " id="T3:U95">1</span></span>, <span class="mxinfo " id="T19:U96">1</span>)</span>, <span class="mxinfo " id="T3:U97"><span class="var type1" id="S15T17U141">P</span>(<span class="mxinfo " id="T3:U99"><span class="var type1" id="S19T3U143">s</span>-<span class="mxinfo " id="T3:U101">1</span></span>, <span class="mxinfo " id="T19:U102">2</span>)</span>]</span>, <span class="mxinfo " id="T30:U103">[<span class="mxinfo " id="T3:U104"><span class="var type1" id="S15T17U149">P</span>(<span class="var type1" id="S19T3U150">s</span>, <span class="mxinfo " id="T19:U107">1</span>)</span>, <span class="mxinfo " id="T3:U108"><span class="var type1" id="S15T17U153">P</span>(<span class="var type1" id="S19T3U154">s</span>, <span class="mxinfo " id="T19:U111">2</span>)</span>]</span>, <span class="mxinfo " id="T30:U112">[<span class="mxinfo " id="T3:U113"><span class="var type1" id="S9T1U159">xm</span>(<span class="var type1" id="S20T3U160">m</span>)</span>, <span class="mxinfo " id="T3:U116"><span class="var type1" id="S10T1U162">ym</span>(<span class="var type1" id="S20T3U163">m</span>)</span>]</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,19" id="srcline19">19</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T5:U119"><span class="var type1" id="S23T3U169">dist_line</span> &lt; <span class="mxinfo " id="T3:U121"><span class="var type1" id="S16T17U171">D</span>(<span class="var type1" id="S20T3U172">m</span>, <span class="mxinfo " id="T3:U124">3</span>)</span></span> &amp;&amp; <span class="mxinfo " id="T5:U125"><span class="var type1" id="S24T3U175">lambda</span> &gt; <span class="mxinfo " id="T3:U127">0</span></span> &amp;&amp; <span class="mxinfo " id="T5:U128"><span class="var type1" id="S24T3U178">lambda</span> &lt; <span class="mxinfo " id="T3:U130">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="43,20" id="srcline20">20</a></span><span class="line">                <span class="mxinfo " id="T3:U131"><span class="mxinfo " id="T3:U132"><span class="var type1" id="S16T17U183">D</span>(<span class="var type1" id="S20T3U184">m</span>, <span class="mxinfo " id="T3:U135">1</span>)</span> = <span class="mxinfo " id="T3:U136"><span class="var type1" id="S19T3U187">s</span>-<span class="mxinfo " id="T3:U138">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,21" id="srcline21">21</a></span><span class="line">                <span class="mxinfo " id="T3:U139"><span class="mxinfo " id="T3:U140"><span class="var type1" id="S16T17U192">D</span>(<span class="var type1" id="S20T3U193">m</span>, <span class="mxinfo " id="T3:U143">2</span>)</span> = <span class="var type1" id="S24T3U195">lambda</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,22" id="srcline22">22</a></span><span class="line">                <span class="mxinfo " id="T3:U145"><span class="mxinfo " id="T3:U146"><span class="var type1" id="S16T17U199">D</span>(<span class="var type1" id="S20T3U200">m</span>, <span class="mxinfo " id="T3:U149">3</span>)</span> = <span class="var type1" id="S23T3U202">dist_line</span></span>;              </span></span>
<span class="srcline"><span class="lineno"><a href="43,23" id="srcline23">23</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,24" id="srcline24">24</a></span><span class="line">        <span class="keyword">end</span>         </span></span>
<span class="srcline"><span class="lineno"><a href="43,25" id="srcline25">25</a></span><span class="line">    <span class="keyword">end</span> </span></span>
<span class="srcline"><span class="lineno"><a href="43,26" id="srcline26">26</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,27" id="srcline27">27</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,28" id="srcline28">28</a></span><span class="line"><span class="comment">% Messpunkte ausfiltern, die vor dem letzten prädizierten Punkt oder zu weit entfernt liegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,29" id="srcline29">29</a></span><span class="line"><span class="mxinfo " id="T31:U151"><span class="var type1" id="S26T31U205">ind</span> = (<span class="mxinfo " id="T31:U153"><span class="mxinfo " id="T31:U154"><span class="mxinfo " id="T1:U155"><span class="var type1" id="S16T17U210">D</span>(<span class="mxinfo " id="T18:U157">:</span>, <span class="mxinfo " id="T19:U158">1</span>)</span> == <span class="mxinfo " id="T3:U159">numel(<span class="var type1" id="S6T1U215">r</span>)</span></span> | <span class="mxinfo " id="T31:U161"><span class="mxinfo " id="T1:U162"><span class="var type1" id="S16T17U218">D</span>(<span class="mxinfo " id="T18:U164">:</span>, <span class="mxinfo " id="T3:U165">3</span>)</span> &gt; <span class="mxinfo " id="T3:U166">1</span></span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,30" id="srcline30">30</a></span><span class="line"><span class="mxinfo " id="T1:U167"><span class="var type1" id="S9T1U225">xm</span>(<span class="var type1" id="S26T31U226">ind</span>) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,31" id="srcline31">31</a></span><span class="line"><span class="mxinfo " id="T1:U170"><span class="var type1" id="S10T1U232">ym</span>(<span class="var type1" id="S26T31U233">ind</span>) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,32" id="srcline32">32</a></span><span class="line"><span class="mxinfo " id="T17:U173"><span class="var type1" id="S16T17U239">D</span>(<span class="var type1" id="S26T31U240">ind</span>, :) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,33" id="srcline33">33</a></span><span class="line"><span class="mxinfo " id="T3:U176"><span class="var type1" id="S5T3U246">nValidPoints</span> = <span class="mxinfo " id="T3:U178">size(<span class="var type1" id="S16T17U249">D</span>, 1)</span></span>; <span class="comment">% Anzahl an letzlich verwerteten Messpunkten</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,34" id="srcline34">34</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,35" id="srcline35">35</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,36" id="srcline36">36</a></span><span class="line"><span class="comment">% Messmatrix H, Messvektor z und Erwartungsvektor zm berechnen</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,37" id="srcline37">37</a></span><span class="line"><span class="mxinfo " id="T2:U180"><span class="var type1" id="S2T2U253">H</span> = <span class="mxinfo " id="T2:U182"><span class="fcn" id="F85N6:B255">messmatrix</span>(<span class="var type1" id="S15T17U256">P</span>, <span class="var type1" id="S6T1U257">r</span>, <span class="var type1" id="S7T3U258">delta</span>, <span class="mxinfo " id="T1:U186"><span class="var type1" id="S16T17U260">D</span>(<span class="mxinfo " id="T18:U188">:</span>, <span class="mxinfo " id="T19:U189">1</span>)</span>, <span class="mxinfo " id="T1:U190"><span class="var type1" id="S16T17U264">D</span>(<span class="mxinfo " id="T18:U192">:</span>, <span class="mxinfo " id="T19:U193">2</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,38" id="srcline38">38</a></span><span class="line"><span class="mxinfo " id="T1:U194"><span class="var type1" id="S3T1U269">z</span> =  <span class="mxinfo " id="T1:U196">zeros(<span class="mxinfo " id="T3:U197"><span class="mxinfo " id="T3:U198">2</span>*<span class="mxinfo " id="T3:U199">numel(<span class="var type1" id="S9T1U276">xm</span>)</span></span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,39" id="srcline39">39</a></span><span class="line"><span class="mxinfo " id="T1:U201"><span class="var type1" id="S4T1U280">zm</span> = <span class="mxinfo " id="T1:U203">zeros(<span class="mxinfo " id="T3:U204"><span class="mxinfo " id="T3:U205">2</span>*<span class="mxinfo " id="T3:U206">numel(<span class="var type1" id="S9T1U287">xm</span>)</span></span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,40" id="srcline40">40</a></span><span class="line"><span class="mxinfo " id="T3:U208"><span class="var type1" id="S30T3U291">count</span> = <span class="mxinfo " id="T3:U210">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,41" id="srcline41">41</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S20T3U295">m</span>=<span class="mxinfo " id="T3:U212">1</span>:<span class="mxinfo " id="T3:U213">numel(<span class="var type1" id="S9T1U300">xm</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,42" id="srcline42">42</a></span><span class="line">        <span class="mxinfo " id="T3:U215"><span class="mxinfo " id="T3:U216"><span class="var type1" id="S3T1U304">z</span>(<span class="var type1" id="S30T3U305">count</span>)</span> = <span class="mxinfo " id="T3:U219"><span class="var type1" id="S9T1U307">xm</span>(<span class="var type1" id="S20T3U308">m</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,43" id="srcline43">43</a></span><span class="line">        <span class="mxinfo " id="T3:U222"><span class="mxinfo " id="T3:U223"><span class="var type1" id="S3T1U312">z</span>(<span class="mxinfo " id="T3:U225"><span class="var type1" id="S30T3U314">count</span> + <span class="mxinfo " id="T3:U227">1</span></span>)</span> = <span class="mxinfo " id="T3:U228"><span class="var type1" id="S10T1U317">ym</span>(<span class="var type1" id="S20T3U318">m</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,44" id="srcline44">44</a></span><span class="line">        <span class="mxinfo " id="T3:U231"><span class="mxinfo " id="T3:U232"><span class="var type1" id="S4T1U322">zm</span>(<span class="var type1" id="S30T3U323">count</span>)</span>     = <span class="mxinfo " id="T3:U235"><span class="mxinfo " id="T3:U236"><span class="var type1" id="S15T17U326">P</span>(<span class="mxinfo " id="T3:U238"><span class="var type1" id="S16T17U328">D</span>(<span class="var type1" id="S20T3U329">m</span>, <span class="mxinfo " id="T19:U241">1</span>)</span>, <span class="mxinfo " id="T3:U242">1</span>)</span> + <span class="mxinfo " id="T3:U243"><span class="mxinfo " id="T3:U244"><span class="var type1" id="S16T17U334">D</span>(<span class="var type1" id="S20T3U335">m</span>, <span class="mxinfo " id="T3:U247">2</span>)</span> * (<span class="mxinfo " id="T3:U248"><span class="mxinfo " id="T3:U249"><span class="var type1" id="S15T17U340">P</span>(<span class="mxinfo " id="T3:U251"><span class="mxinfo " id="T3:U252"><span class="var type1" id="S16T17U343">D</span>(<span class="var type1" id="S20T3U344">m</span>, <span class="mxinfo " id="T19:U255">1</span>)</span>+<span class="mxinfo " id="T3:U256">1</span></span>, <span class="mxinfo " id="T3:U257">1</span>)</span> - <span class="mxinfo " id="T3:U258"><span class="var type1" id="S15T17U349">P</span>(<span class="mxinfo " id="T3:U260"><span class="var type1" id="S16T17U351">D</span>(<span class="var type1" id="S20T3U352">m</span>, <span class="mxinfo " id="T19:U263">1</span>)</span>, <span class="mxinfo " id="T3:U264">1</span>)</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,45" id="srcline45">45</a></span><span class="line">        <span class="mxinfo " id="T3:U265"><span class="mxinfo " id="T3:U266"><span class="var type1" id="S4T1U358">zm</span>(<span class="mxinfo " id="T3:U268"><span class="var type1" id="S30T3U360">count</span> + <span class="mxinfo " id="T3:U270">1</span></span>)</span> = <span class="mxinfo " id="T3:U271"><span class="mxinfo " id="T3:U272"><span class="var type1" id="S15T17U364">P</span>(<span class="mxinfo " id="T3:U274"><span class="var type1" id="S16T17U366">D</span>(<span class="var type1" id="S20T3U367">m</span>, <span class="mxinfo " id="T19:U277">1</span>)</span>, <span class="mxinfo " id="T3:U278">2</span>)</span> + <span class="mxinfo " id="T3:U279"><span class="mxinfo " id="T3:U280"><span class="var type1" id="S16T17U372">D</span>(<span class="var type1" id="S20T3U373">m</span>, <span class="mxinfo " id="T3:U283">2</span>)</span> * (<span class="mxinfo " id="T3:U284"><span class="mxinfo " id="T3:U285"><span class="var type1" id="S15T17U378">P</span>(<span class="mxinfo " id="T3:U287"><span class="mxinfo " id="T3:U288"><span class="var type1" id="S16T17U381">D</span>(<span class="var type1" id="S20T3U382">m</span>, <span class="mxinfo " id="T19:U291">1</span>)</span>+<span class="mxinfo " id="T3:U292">1</span></span>, <span class="mxinfo " id="T3:U293">2</span>)</span> - <span class="mxinfo " id="T3:U294"><span class="var type1" id="S15T17U387">P</span>(<span class="mxinfo " id="T3:U296"><span class="var type1" id="S16T17U389">D</span>(<span class="var type1" id="S20T3U390">m</span>, <span class="mxinfo " id="T19:U299">1</span>)</span>, <span class="mxinfo " id="T3:U300">2</span>)</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,46" id="srcline46">46</a></span><span class="line">        <span class="mxinfo " id="T3:U301"><span class="var type1" id="S30T3U395">count</span> = <span class="mxinfo " id="T3:U303"><span class="var type1" id="S30T3U397">count</span> + <span class="mxinfo " id="T3:U305">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,47" id="srcline47">47</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
</pre>
